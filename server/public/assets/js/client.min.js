/*! sportngin 2016-06-03 */
var app=angular.module("tryoutsApp",["ngRoute","angular-loading-bar","mobile-angular-ui","mobile-angular-ui.gestures","pickadate"]);app.config(["$routeProvider","$locationProvider",function(a,b){a.when("/",{templateUrl:"/app/view/home",controller:"HomeController",controllerAs:"home"}).when("/logout",{templateUrl:"/app/view/home",controller:"LogoutController",controllerAs:"logout"}).when("/archives",{templateUrl:"/app/view/archives",controller:"ArchivesController",controllerAs:"archive"}).when("/new",{templateUrl:"/app/view/new",controller:"TryoutInputController",controllerAs:"input"}).when("/edit/:id",{templateUrl:"/app/view/edit/",controller:"EditController",controllerAs:"edit"}).when("/players/:id",{templateUrl:"/app/view/players",controller:"PlayerNumberController",controllerAs:"num"}).when("/tryout/:id",{templateUrl:"/app/view/tryout",controller:"TryoutReviewController",controllerAs:"review"}).when("/scoreplayer/:id/:player",{templateUrl:"/app/view/scoreplayer",controller:"AssignScoreController",controllerAs:"assign"}).otherwise({templateUrl:"/app/view/404",controller:"ErrorController",controllerAs:"error"}),b.html5Mode(!0)}]),app.config(["cfpLoadingBarProvider",function(a){a.includeSpinner=!1}]),app.controller("AssignScoreController",["TryoutService","$routeParams","$scope","UserService","$location",function(a,b,c,d,e){var f=this;d.isAuthenticated(function(a,b){0==a&&e.path("/")}),f.player=a.data;var g=(a.data,{player_id:b.player,tryout_id:b.id});f.back=function(){a.backToReview(g.tryout_id)},f.calcTotal=function(){for(var a=f.player.val.players[0].categories,b=0,c=0;c<a.length;c++)a[c].score&&(b+=a[c].score);f.player.val.players[0].total=b},f.saveScoresAndTotal=function(b){a.saveTotal(b,g.tryout_id)},a.getOnePlayer(g)}]),app.controller("TryoutReviewController",["$routeParams","TryoutService","UserService","$location",function(a,b,c,d){var e=this;c.isAuthenticated(function(a,b){0==a&&d.path("/")});new Date;e.playerInfo={tryout_id:""},e.displayTryout=b.data,e.playerInfo.tryout_id=a.id,e.reviewPlayer=function(a){e.playerInfo.player_id=a.player_id,b.scorePlayer(e.playerInfo)},e.editTryout=function(){b.editThisTryout(e.playerInfo.tryout_id)},b.fetchOneTryout(e.playerInfo.tryout_id)}]),app.controller("PlayerNumberController",["$routeParams","TryoutService",function(a,b){var c=this;c.playerProfiles=[],c.playersList=b.data,c.tryout_id=a.id,c.savePlayers=function(){for(var a=0;a<c.playersList.val.length;a++)c.playerTryout={jerseyNum:"",profiles:{}},c.playerTryout.profiles.survey_id=c.playersList.val[a].survey_result_id,c.playerTryout.profiles.first_name=c.playersList.val[a].qu_el_3797779,c.playerTryout.profiles.last_name=c.playersList.val[a].qu_el_3797780,c.playerTryout.profiles.level=c.playersList.val[a].qu_el_3797961,c.playerTryout.jerseyNum=c.playersList.val[a].alias,c.playerProfiles.push(c.playerTryout);b.savePlayersToDb(c.playerProfiles,c.tryout_id)},c.back=function(){},b.getPlayers()}]),app.controller("AppController",["UserService",function(a){var b=this;b.user=a.user,a.isAuthenticated(function(a,b){console.log(a)})}]),app.controller("HomeController",["$http","UserService","TryoutService","$location","$timeout","cfpLoadingBar","$route","$templateCache",function(a,b,c,d,e,f,g,h){var i=this;i.tryouts=[],i.guest={},i.tryoutToDelete={},i.tryouts=c.data,i.playerInfo={tryout_id:""},b.isAuthenticated(function(a,b){a===!0&&(c.fetchTryouts(),i.generateGuestCode=function(a){c.generateCode(a)},i.deleteTryout=function(a){c.deleteTryout(a)},i.reviewTryout=function(a){c.reviewATryout(a)},i.createNew=function(){c.inputTryout()},i.editTryout=function(a){c.editThisTryout(a)},b.guest===!0&&(c.fetchOneTryout(null,b.username,function(a){i.playerInfo.tryout_id=a._id}),i.reviewPlayer=function(a){i.playerInfo.player_id=a.player_id,c.scorePlayer(i.playerInfo)}))}),i.guestLogin=function(){b.guestAuthentication(i.guest,function(a){if(a===!0){console.log("about to reload");var b=g.current.templateUrl;h.remove(b),g.reload()}})},f.start(),i.fakeIntro=!0,e(function(){f.complete(),i.fakeIntro=!1},1250)}]),app.controller("TryoutInputController",["TryoutService","UserService","$location","$routeParams",function(a,b,c,d){var e=this;b.isAuthenticated(function(b){if(b===!0){var d=1;e.tryout={},e.categories=[{id:1}],e.today=new Date,e.addField=function(){d+=1,e.categories.push({id:d})},e.removeField=function(a){e.categories.splice(a,1)},e.submitInfo=function(){e.tryout.categories=e.categories,a.saveTryoutInfo(e.tryout)},e.back=function(){window.history.back()}}else c.path("/")})}]),app.controller("EditController",["TryoutService","UserService","$routeParams","$location","$scope",function(a,b,c,d,e){b.isAuthenticated(function(a,b){0==a&&d.path("/")});var f=this;f.tryoutData=a.data,f.tryout_id=c.id,f.num={},console.log("About to run fetchOneTryout"),a.fetchOneTryout(c.id,null,function(){f.num=originalData.tryoutData.val.categories.length+1}),f.addField=function(){f.num+=1,f.tryoutData.val.categories.push({id:f.num})},f.removeField=function(a){f.tryoutData.val.categories.splice(a,1)},f.back=function(){a.backToReview(f.tryout_id)},f.saveEdits=function(){a.saveTryoutEdits(f.tryoutData.val)}}]),app.controller("LogoutController",["UserService","$templateCache","$location",function(a,b,c){b.removeAll(),a.isAuthenticated(function(b){b===!0?a.logout(function(){a.isAuthenticated(function(a){console.log(a),c.path("/")})}):c.path("/")})}]),app.controller("ArchivesController",["TryoutService","UserService","$location",function(a,b,c){var d=this;b.isAuthenticated(function(a,b){0==a&&c.path("/")}),d.displayArchivedTryouts=a.data,d.reviewTryout=function(b){a.reviewATryout(b)},a.fetchArchivedTryouts()}]),app.controller("ErrorController",function(){}),app.factory("UserService",["$http",function(a){var b={},c=function(b){a.get("/auth/logout").then(function(a){b()})},d=function(c){a.get("/auth/check").then(function(a){a.data.success===!0?(b.data=a.data.user,c(!0,a.data.user)):(b.data=a.data,c(!1))})},e=function(c,d){a.post("/auth/guest",c).then(function(a){b.guest=a.data.guest,d(!0)},function(a){d(!1)})},f=function(b,c){a.get("/app/view/home/"+b).then(function(a){c(!0)},function(a){c(!1)})};return{user:b,logout:c,isAuthenticated:d,guestAuthentication:e,guestLogin:f}}]),app.factory("TryoutService",["$http","$location","UserService",function(a,b,c){var d={},e=function(c){a.post("/app/view/new",c).then(function(a){b.path("/players/"+a.data._id)})},f=function(b){a.get("/app/view/guestcode/"+b._id).then(function(a){h()})},g=function(){a.get("/app/view/players/testAPI").then(function(a){d.val=a.data})},h=function(){a.get("/app/view/data").then(function(a){var b=new Date;b.setDate(b.getDate()-1),b.setHours(0,0,0,0);var c=new Date(b);d.val=a.data.filter(function(a){return Date.parse(a.date)>c})})},i=function(){a.get("/app/view/data").then(function(a){var b=new Date;b.setDate(b.getDate()-1),b.setHours(0,0,0,0);var c=new Date(b);d.val=a.data.filter(function(a){return Date.parse(a.date)<=c})})},j=function(b){a["delete"]("/app/view/"+b._id).then(function(a){h()})},k=function(c,d){a.put("/app/view/players/"+d,c).then(function(a){b.path("/tryout/"+d)})},l=function(a){b.path("/scoreplayer/"+a.tryout_id+"/"+a.player_id)},m=function(b){var c={params:{tryout_id:b.tryout_id,player_id:b.player_id}};a.get("/app/view/scoreplayer/input/",c).then(function(a){d.val=a.data})},n=function(b,c,e){console.log("fetchOneTryout"),null===b?(console.log("Enter code fetch. Code",c),a.get("/app/view/tryout/guest/"+c).then(function(a){d.val=a.data,e(a.data)})):a.get("/app/view/tryout/get/"+b).then(function(a){d.val=a.data})},o=function(d,e){a.put("/app/view/scoreplayer/"+e,d).then(function(a){c.isAuthenticated(function(a,c){c.guest===!0?b.path("/"):b.path("/tryout/"+e)})})},p=function(a){b.path("/tryout/"+a._id)},q=function(){b.path("/new/")},r=function(a){b.path("/edit/"+a)},s=function(d){a.put("/app/view/edit/"+d._id,d).then(function(a){c.isAuthenticated(function(a,c){c.guest===!0?b.path("/"):b.path("/tryout/"+d._id)})})},t=function(a){c.isAuthenticated(function(c,d){d.guest===!0?b.path("/"):b.path("/tryout/"+a)})};return{saveTryoutInfo:e,generateCode:f,fetchTryouts:h,fetchArchivedTryouts:i,deleteTryout:j,savePlayersToDb:k,scorePlayer:l,getPlayers:g,getOnePlayer:m,fetchOneTryout:n,saveTotal:o,reviewATryout:p,inputTryout:q,editThisTryout:r,saveTryoutEdits:s,backToReview:t,data:d}}]);